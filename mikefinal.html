<!DOCTYPE html>
<html>

<head>
    <title>Jamcestry (WORKING)</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js">
    <link href="https://fonts.googleapis.com/css?family=Lobster|Amiri|Bellefair|Pacifico|Josefin+Sans" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css?family=Amiri" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Bellefair" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Josefin+Sans" rel="stylesheet"> -->
    <link rel="stylesheet" href="mikestyle.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<div id="background-blur"></div>
<div id="background-clean"></div>

<body>

    <div id="page-header">
        <h1>
            <span>
                <img id="header-icon" src="images/Glyphicon.png">
            </span>Jamcestry
            <i class="fas fa-redo-alt"></i>
            <i class="fas fa-bed"></i>
            <i class="fas fa-headphones"></i>
        </h1>


    </div>
    <div id="content-container">


        <div class="row" id="searchBar">
            <div class="col-md-3 offset-md-1">
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" id="artistForm" placeholder="Enter an artist...">
                    </div>
                </form>
            </div>
            <div class="col-md-2">
                <button type="button" class="btn btn-primary" id="addArtist">Submit</button>
            </div>
        </div>

        <div class="row">
            <div class="card col-md-7 offset-md-1">
                <div id="artist-name">

                </div>

                <div id="pic">

                </div>

                <div id="input">
                        <div class="row">

                                <div class="col-md-6 offset-md-3" id="player">
                
                                </div>
                            </div>

                </div>

                <div class="row">

                    <div class="col-md-6">
                        <p id="toggle1">
                            <strong>Influences</strong>
                        </p>
                        <div id="influences">
                        </div>
                    </div>

                    <div class="col-md-6">
                        <p id="toggle2">
                            <strong>Followers</strong>
                        </p>
                        <div id="followers">
                        </div>
                    </div>
                </div>
            </div>



            <div class="card col-md-2 offset-md-1" id="trees">
                <div id="tree1">
                    <p id="select1">
                        <span>
                            <strong>Tree Tracker</strong>
                        </span>
                        <!-- <button type="button" class="btn btn-secondary" data-toggle="tooltip" data-html="true" title="<em>Tooltip</em> <u>with</u> <b>HTML</b>">
                            Tooltip with HTML
                          </button> -->
                        <span>
                            <img src="images/treeInstructionsIcon.png" class="treeInstructions" data-toggle="tooltip" data-html="true" title="ls<span><img src='images/treeIconWhite.png' class='treeWhite' width='30' height='30'><p>This icon means that this artist is a follower to the previous artist</p></span>">
                        </span>
                        <div id="primaryArtist">

                        </div>
                    </p>
                </div>
                <button type="button" class="btn clear-tree" id="clear1" style="margin-top:5px">Clear Tree</button>
            </div>
            <br>

        </div>
    </div>
    <br>
    <br>
    <br>
    <br>
    <div class="icons">
        <div>
            <h1 id="openingHeader">Jamcestry</h1>
            <div class="bigicons">
                <img src="images/magnify.png" id="iconz"></panel><img src="images/learn.png" id="iconz"><img src="images/build.png" id="iconz"><br>
                </div>
                <div id= "iconzText">Search.<span style="display:inline-block; width: 80px;"></span> Learn.<span style="display:inline-block; width: 90px;"></span> Build.</div>

        </div>
        <div class="row">
            <div id="searchBarOpener" class="col-md-2 offset-md-5">
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" id="artistFormOpener" placeholder="Enter an artist...">
                    </div>
                </form>
            </div>
        </div>
        <div>

            <button type="button" class="btn btn-primary" id="addArtistOpener">Submit</button>

        </div>
    </div>
    </div>

    </div>

    <div class="footer">

        <p class="footp">
            <strong>Powered by </strong>
            <img src="images/napster.png" id="napster">
            <img src="images/lastfm.png" id="lastfm">
            <img src="images/youtube.png" id="youtube">
        </p>

        <p class="footp">
            <strong>Connect with us! </strong>
            <a href="https://www.instagram.com" target="_blank">
                <img src="images/insta.png" id="insta">
            </a>
            <a href="https://www.twitter.com/jamcestry" target="_blank">
                <img src="images/twitter.png" id="twitter">
            </a>
            <p class="footp">
                <strong>&copy; 2018 Jamcestry</strong>
            </p>


    </div>



    <script>



        var cardCreation = function (enter) {

            var discogsURL = "https://api.discogs.com/database/search?q=" + enter + "&key=hbrLdVvWBgVAqaAOpKos&secret=TlXBKlwWFLoTNJHYyBEIhzNIaZoVpHnV";

            var lastfmURL = "http://ws.audioscrobbler.com/2.0/?method=artist.getinfo&artist=" + enter + "&autocorrect=1&api_key=229233f9c10fcdec813ab2191288db9f&format=json";

            var napsterURL = "http://api.napster.com/v2.2/search?apikey=ZDRkYzMyYmEtMmVjMy00YmUwLThmNDQtOTc3Y2UzMGEzNTNm&query=" + enter + "&type=artist&limit=1";

            

            $.ajax({
                url: lastfmURL,
                method: "GET"
            }).then(function (response) {

                var artistName = response.artist.name

                $("#artist-name").html("<h2>" + artistName + "<h2>");

                var imageSrc = response.artist.image[response.artist.image.length - 1];

                var imageElement = imageSrc[Object.keys(imageSrc)[0]];

                var image = $("<img src='" + imageElement + "' style='height: 200px; width: 200px' class='artistImage'>");

                $("#pic").html(image);

                var personGenre = [];
                var personGenreString = response.artist.tags.tag;
                for (var i = 0; i < personGenreString.length; i++) {

                    if (i <= 0) {
                        personGenre.push(personGenreString[i].name);
                    }
                    else {
                        personGenre.push(" " + personGenreString[i].name);
                    }
                }

                var similarArtists = [];
                var similarArtistsString = response.artist.similar.artist;


                for (var i = 0; i < similarArtistsString.length; i++) {

                    if (i <= 0) {
                        similarArtists.push("<a href='https://en.wikipedia.org/wiki/" + similarArtistsString[i].name + "' target='_blank'>" + similarArtistsString[i].name + "</a>");
                    }
                    else {
                        similarArtists.push(" " + "<a href='https://en.wikipedia.org/wiki/" + similarArtistsString[i].name + "' target='_blank'>" + similarArtistsString[i].name + "</a>");
                    }
                }

                var person = ["<div class='bio' id='bio'><b>Bio: </b>" + response.artist.bio.content + "</div>",
                "<b>Genre: </b>" + personGenre,
                "<b>Find Similar Artists: </b>" + similarArtists];

                var seeMore = $("<div>");
                seeMore.text("See more...");
                $("#bio").append(seeMore);

                var personDiv = $("<div>");

                for (var i = 0; i < person.length; i++) {
                    var artist = $("<div>");
                    artist.html(person[i]);
                    personDiv.append(artist);
                    personDiv.append("<br>");
                }
                $("#pic").append(personDiv);
            });




            $.ajax({
                url: napsterURL,
                method: "GET"
            }).then(function (response) {

                var influencesIDs = [];

                var followersIDs = [];

                if (response.search.data.artists[0].links.influences !== undefined) {
                    var ids = response.search.data.artists[0].links.influences.ids;
                    for (var i = 0; i < ids.length; i++) {
                        influencesIDs.push(response.search.data.artists[0].links.influences.ids[i]);
                    }
                }

                if (response.search.data.artists[0].links.followers !== undefined) {
                    var ids = response.search.data.artists[0].links.followers.ids;
                    for (var i = 0; i < ids.length; i++) {
                        followersIDs.push(response.search.data.artists[0].links.followers.ids[i]);
                    }
                }

                influencesIDs.splice(10);

                followersIDs.splice(10);

                var infButtons = $("<div>");

                var folButtons = $("<div>");

                for (var i = 0; i < influencesIDs.length; i++) {

                    var napsterInfluencesURL = "https://api.napster.com/v2.2/artists/" + influencesIDs[i] + "?apikey=ZDRkYzMyYmEtMmVjMy00YmUwLThmNDQtOTc3Y2UzMGEzNTNm";

                    $.ajax({
                        url: napsterInfluencesURL,
                        method: "GET"
                    }).then(function (info) {
                        infButtons.append($("<button id='infl' class='btn btn-outline-primary'>").html(info.artists[0].name));

                    });

                };

                for (var i = 0; i < followersIDs.length; i++) {

                    var napsterFollowersURL = "https://api.napster.com/v2.2/artists/" + followersIDs[i] + "?apikey=ZDRkYzMyYmEtMmVjMy00YmUwLThmNDQtOTc3Y2UzMGEzNTNm";

                    $.ajax({
                        url: napsterFollowersURL,
                        method: "GET"
                    }).then(function (info) {
                        folButtons.append($("<button id='fol' class='btn btn-outline-primary'>").html(info.artists[0].name));

                    });
                };

                $("#influences").html(infButtons);

                $("#followers").html(folButtons);



            });

        };

        var userSearchDone = false;
        var treeOneButtons = $("<div class='tr1'>");
        var nextTree = $("<div>");

        $(".card").hide();
        $("#searchBar").hide();
        $("#page-header").hide();

        $(".footer").hide();


        $(document).bind('keypress', function (e) {
            if (e.keyCode == 13 && !userSearchDone) {
                $('#addArtistOpener').trigger('click');
            } else if (e.keyCode == 13 && userSearchDone) {
                $('#addArtist').trigger('click');

            }
        });

        $("#addArtistOpener").on("click", function () {
            event.preventDefault();
            userSearchDone = true;
            var userInputOpener = $("#artistFormOpener").val();
            var player = userInputOpener;
            userInputOpener = userInputOpener.replace("+", " ").toUpperCase();
            cardCreation(userInputOpener);
            $("#artistFormOpener").val("");
            $(".icons").fadeOut(500);
            $("#searchBarOpener").fadeOut(500);
            $(treeOneButtons).html("<hr>" + userInputOpener + "<hr>");
            $("#tree1").append(treeOneButtons);

$("#player").html(
                "<iframe id='ytplayer' type='text/html' width='480' height='270' src='https://www.youtube.com/embed?listType=search&type=video&videoEmbeddable=true&list=" +
                player + "' frameborder='0'></iframe>");

            $(".icons").promise().done(function () {
                $(".footer").fadeIn(3000);
                $("#page-header").fadeIn(500);
                $("#searchBar").fadeIn(500);
                $(".card").fadeIn(1000);
                $("#background-blur").fadeOut(500);
                $("#background-clean").fadeIn(500);
                // will be called when all the animations on the queue finish
            });

        });

        $("#addArtist").on("click", function () {

            event.preventDefault();
            var userInput = $("#artistForm").val();
            treeOneButtons.append("<hr>" + userInput + "<hr>");
            $("#tree1").append(treeOneButtons);
            userInput = userInput.replace(" ", "+");
            var player = userInput;
            cardCreation(userInput);
            $("#artistForm").val("");
            $("#tree1").append(treeOneButtons);
            player = userInput;
            $("#player").html(
                "<iframe id='ytplayer' type='text/html' width='480' height='270' src='https://www.youtube.com/embed?listType=search&list=" +
                player + "' frameborder='0'></iframe>");

            // $("#tree1").append(nextTree);




        });




        var treeOne = true;

        $(document).on("click", "#infl", function () {
            var userInput = $(this).text()
            cardCreation(userInput);
            console.log($(this).attr("id", "infl"));
            treeOneButtons.append($("<button id='inflTree' class='btn inflTreeIcon' width='100%'>").html("<span><img src='images/seedIconWhite.png' class='seedWhite' width='30' heigh='25'>" + userInput + "</span>"));
            $("#tree1").append(treeOneButtons);
            var player = userInput;
            $("#player").html(
                "<iframe id='ytplayer' type='text/html' width='480' height='270' src='https://www.youtube.com/embed?listType=search&list=" +
                player + "' frameborder='0'></iframe>");

        });





        $(document).on("click", ".inflTreeIcon", function () {
            var userInput = $(this).text()
            cardCreation(userInput);
            var player = userInputOpener;
        });


        $(document).on("click", "#fol", function () {
            var userInput = $(this).text()
            cardCreation(userInput);
            treeOneButtons.append($("<button id='folTree' class='btn folTreeIcon' width='100%'>").html("<span><img src='images/treeIconWhite.png' class='treeWhite' width='30' height='30' style='display: inline; vertical-align: middle'>" + userInput + "</span>"));
            $("#tree1").append(treeOneButtons);
            var player = userInput;
            $("#player").html(
                "<iframe id='ytplayer' type='text/html' width='480' height='270' src='https://www.youtube.com/embed?listType=search&list=" +
                player + "' frameborder='0'></iframe>");

        });



        $(document).on("click", ".folTreeIcon", function () {
            var userInput = $(this).text()
            cardCreation(userInput);
        });

        $(document).on("click", "#clear1", function () {
            $(".tr1").empty();
        });



        $(document).on("click", "#select1", function () {

            if (!treeOne) {
                treeOne = true;
                $("#tree1").attr("style", "background-color: lightgray")
                $("#tree2").attr("style", "background-color: white")
                console.log(treeOne);
            }
        });

        var expand = false;

        $(document).on("click", ".bio", function () {
            if (!expand) {
                $(this).removeAttr("id", "bio");
                expand = true;
            }
            else {
                $(this).attr("id", "bio");
                expand = false;
            }
        });



    </script>


</body>


</html>