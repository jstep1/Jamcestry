<!DOCTYPE html>
<html>
<head>
	<title>Jamcestry (WORKING)</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
    <div class="col-md-6">
        <div class="row-md-6">
        <form>
            <div class="form-group">
                <input type="text" class="form-control" id="artistForm" placeholder="Enter an artist...">
            </div>
        </form>
        </div>
        <div class="col-md-2">
        <button type="button" class="btn btn-primary" id="addArtist">Submit</button>
        </div>
        </div>
    </div>
    <div class="row-md-6">

        <div class="col-md-1">
            <p>Influences</p>
            <div id="influences">
            </div>
        </div>
    
    <div class="card col-md-4">
    	   <div id="pic">

    	   </div>

    	   <div id="input">
    		
           </div><br>
           </div>

    

                    
                <div class="col-md-1">
                    <p>Followers</p>
                    <div id="followers">
                    </div>
                </div>
            </div>
        </div>
    
	

<script>

var cardCreation = function(enter) {

var discogsURL = "https://api.discogs.com/database/search?q=" + enter + "&key=hbrLdVvWBgVAqaAOpKos&secret=TlXBKlwWFLoTNJHYyBEIhzNIaZoVpHnV&secret=secret=TlXBKlwWFLoTNJHYyBEIhzNIaZoVpHnV";

var lastfmURL = "http://ws.audioscrobbler.com/2.0/?method=artist.getinfo&artist=" + enter + "&api_key=229233f9c10fcdec813ab2191288db9f&format=json";

var napsterURL = "http://api.napster.com/v2.2/search?apikey=ZDRkYzMyYmEtMmVjMy00YmUwLThmNDQtOTc3Y2UzMGEzNTNm&query=" + enter + "&type=artist&limit=1";

$.ajax({
          url: discogsURL,
          method: "GET"
        }).then(function(response) {

        	var id = response.results[0].resource_url;
        	console.log(id);

        	$.ajax({
        		url: id,
        		method: "GET"
        	}).then(function(info) {

        		var person = ["Name: " + info.name,
        			"Bio: " + info.profile,
        			"Real Name: " + info.realname,
        			"Webpage: " + info.urls[0]];

        		console.log(person);

                var personDiv = $("<div>");

        	for(var i=0; i<person.length; i++) {
        		var artist = $("<div>");
        		artist.html(person[i]);
        		personDiv.append(artist);
        	}
            $("#input").html(personDiv);
        });

	});



$.ajax({
          url: lastfmURL,
          method: "GET"
        }).then(function(response) {

            var imageSrc = response.artist.image[response.artist.image.length - 1];

            var imageElement = imageSrc[Object.keys(imageSrc)[0]];
        	
        	var image = $("<img src='" + imageElement + "' style='height: 200px; width: 200px'>");

        	$("#pic").html(image);
        });

$.ajax({
          url: napsterURL,
          method: "GET"
        }).then(function(response) {

        var influencesIDs = response.search.data.artists[0].links.influences.ids;

        var followersIDs = response.search.data.artists[0].links.followers.ids;

        influencesIDs.splice(10);

        followersIDs.splice(10);

        console.log(influencesIDs);
        console.log(followersIDs);

        var infButtons = $("<div>");

        var folButtons = $("<div>");

        for(var i=0; i < influencesIDs.length; i++){

            var napsterInfluencesURL = "https://api.napster.com/v2.2/artists/" + influencesIDs[i] + "?apikey=ZDRkYzMyYmEtMmVjMy00YmUwLThmNDQtOTc3Y2UzMGEzNTNm";

            $.ajax({
                url: napsterInfluencesURL,
                method: "GET"
            }).then(function(info) {
                infButtons.append($("<button id='infl'>").html(info.artists[0].name));
                    if(i % 2 !== 0) {
                    infButtons.append("<br>");
                        };
                    });

        };

        for(var i=0; i < followersIDs.length; i++){

            var napsterFollowersURL = "https://api.napster.com/v2.2/artists/" + followersIDs[i] + "?apikey=ZDRkYzMyYmEtMmVjMy00YmUwLThmNDQtOTc3Y2UzMGEzNTNm";

            $.ajax({
                url: napsterFollowersURL,
                method: "GET"
            }).then(function(info) {
                folButtons.append($("<button id='fol'>").html(info.artists[0].name));
                    if(i % 2 !== 0) {
                    folButtons.append("<br>");
                        };
                    });
        };

        $("#influences").html(infButtons);

        $("#followers").html(folButtons);

        

        });
  
};

$("#addArtist").on("click", function() {
    event.preventDefault();
    var userInput = $("#artistForm").val();
    userInput = userInput.replace(" ","+");
    console.log(userInput);
    cardCreation(userInput);

});

$(document).on("click", "#infl", function() {
    var userInput = $(this).text()
    cardCreation(userInput);
});

$(document).on("click", "#fol", function() {
    var userInput = $(this).text()
    cardCreation(userInput);
});
      
</script>
</body>
</html>